<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/styles.31b1cbf7264e72d33a4e.css">.header-inner a{font-size:16px;font-family:monospace;color:#fff;text-transform:uppercase;-webkit-transition:color .2s ease-out;transition:color .2s ease-out}.header-inner a:hover{color:#b4b4b4}.header-links a{margin-right:1rem}.header-inner{display:flex;justify-content:space-between}.social-media-icons{text-align:right}.social-media-icons a{margin-left:8px}@media screen and (max-width:560px){.social-media-icons{display:none}}.icon{width:24px;vertical-align:middle;-webkit-transition:all .5s ease-out;transition:all .5s ease-out;fill:#e6e6e6}.icon-link.mail>svg{width:18px;margin-left:10px}.icon:hover{fill:navy;//transform:scale(1.25)}.youtube>svg:hover{fill:#b00}.facebook>svg:hover{fill:#7e97cd}.twitter>svg:hover{fill:#00aced}.instagram>svg:hover{fill:#f77737}.linkedin>svg:hover{fill:#33beff}.soundcloud>svg:hover{fill:#f50}.github>svg:hover{fill:purple}.page-footer{background-color:#0f1214;font-size:.8rem;padding-top:1.2rem;padding-bottom:1.2rem}.page-footer-grid{display:flex;justify-content:space-between}.footer-social-icons{text-align:right}html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}article,aside,details,figcaption,figure,footer,header,main,menu,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block}audio:not([controls]){display:none;height:0}progress{vertical-align:baseline}[hidden],template{display:none}a{background-color:transparent;-webkit-text-decoration-skip:objects;text-decoration:none;color:#99daff}a:active,a:hover{outline-width:0}abbr[title]{border-bottom:none;text-decoration:underline;-webkit-text-decoration:underline dotted;text-decoration:underline dotted}b,strong{font-weight:inherit;font-weight:bolder}dfn{font-style:italic}h1{font-size:2em;margin:.67em 0}mark{background-color:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}svg:not(:root){overflow:hidden}code,kbd,pre,samp{font-family:monospace,monospace;font-size:1em}figure{margin:1em 40px}hr{box-sizing:content-box;height:0;overflow:visible}button,input,optgroup,select,textarea{font:inherit;margin:0}optgroup{font-weight:700}button,input{overflow:visible}button,select{text-transform:none}[type=reset],[type=submit],button,html [type=button]{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-cancel-button,[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-input-placeholder{color:inherit;opacity:.54}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}html{font:112.5%/1.45em georgia,serif;box-sizing:border-box;overflow-y:scroll}*,:after,:before{box-sizing:inherit}body{background-color:#171819;color:#d7d7d7;font-family:georgia,serif;font-weight:400;word-wrap:break-word;-webkit-font-kerning:normal;font-kerning:normal;-ms-font-feature-settings:"kern","liga","clig","calt";font-feature-settings:"kern","liga","clig","calt"}img{max-width:100%;padding:0;margin:0 0 1.45rem}h1{font-size:2.25rem}h1,h2{padding:0;margin:0 0 1.45rem;color:inherit;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Fira Sans,Droid Sans,Helvetica Neue,sans-serif;font-weight:700;text-rendering:optimizeLegibility;line-height:1.1}h2{font-size:1.62671rem}h3{font-size:1.38316rem}h3,h4{padding:0;margin:0 0 1.45rem;color:inherit;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Fira Sans,Droid Sans,Helvetica Neue,sans-serif;font-weight:700;text-rendering:optimizeLegibility;line-height:1.1}h4{font-size:1rem}h5{font-size:.85028rem}h5,h6{padding:0;margin:0 0 1.45rem;color:inherit;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Fira Sans,Droid Sans,Helvetica Neue,sans-serif;font-weight:700;text-rendering:optimizeLegibility;line-height:1.1}h6{font-size:.78405rem}hgroup{padding:0;margin:0 0 1.45rem}ol,ul{padding:0;margin:0 0 1.45rem 1.45rem;list-style-position:outside;list-style-image:none}dd,dl,figure,p{padding:0;margin:0 0 1.45rem}pre{margin:0 0 1.45rem;font-size:.85rem;line-height:1.42;background:rgba(0,0,0,.04);border-radius:3px;overflow:auto;word-wrap:normal;padding:1.45rem}table{font-size:1rem;line-height:1.45rem;border-collapse:collapse;width:100%}fieldset,table{padding:0;margin:0 0 1.45rem}blockquote{padding:0;margin:0 1.45rem 1.45rem}form,iframe,noscript{padding:0;margin:0 0 1.45rem}hr{padding:0;margin:0 0 calc(1.45rem - 1px);background:#353535;border:none;height:1px}address{padding:0;margin:0 0 1.45rem}b,dt,strong,th{font-weight:700}li{margin-bottom:.725rem}ol li,ul li{padding-left:0}li>ol,li>ul{margin-left:1.45rem;margin-bottom:.725rem;margin-top:.725rem}blockquote :last-child,li :last-child,p :last-child{margin-bottom:0}li>p{margin-bottom:.725rem}code,kbd,samp{font-size:.85rem;line-height:1.45rem}abbr,abbr[title],acronym{border-bottom:1px dotted rgba(0,0,0,.5);cursor:help}abbr[title]{text-decoration:none}td,th,thead{text-align:left}td,th{border-bottom:1px solid rgba(0,0,0,.12);font-feature-settings:"tnum";-moz-font-feature-settings:"tnum";-ms-font-feature-settings:"tnum";-webkit-font-feature-settings:"tnum";padding:.725rem .96667rem calc(.725rem - 1px)}td:first-child,th:first-child{padding-left:0}td:last-child,th:last-child{padding-right:0}code,tt{background-color:rgba(0,0,0,.04);border-radius:3px;font-family:SFMono-Regular,Consolas,Roboto Mono,Droid Sans Mono,Liberation Mono,Menlo,Courier,monospace;padding:.2em 0}pre code{background:none;line-height:1.42}code:after,code:before,tt:after,tt:before{letter-spacing:-.2em;content:" "}pre code:after,pre code:before,pre tt:after,pre tt:before{content:""}@media only screen and (max-width:480px){html{font-size:100%}}.section-1{display:flex}.section-1-text{padding-top:1rem;padding-left:1.5rem;padding-right:1rem;max-width:800px}.section-1-img-wrapper{width:50%;max-width:600px}@media screen and (max-width:1000px){.section-1-text{max-width:600px}}@media screen and (max-width:760px){.section-1{display:block}.section-1-img-wrapper{margin:0 auto}.section-1-text{padding-top:0}}.grid{display:grid;justify-content:space-between;grid-gap:30px;grid-template-columns:1fr 1fr}h1{font-size:2.8rem}.home-intro-section{background:-webkit-gradient(linear,left top,left bottom,from(rgba(0,0,0,.65)),to(rgba(0,0,0,.65))),url(/static/ferdinand-stohr-NFs6dRTBgaM-unsplash-bcdff4ad859eb5ec0d2706b312fd360d.jpg) no-repeat 50% fixed;background:linear-gradient(rgba(0,0,0,.65),rgba(0,0,0,.65)),url(/static/ferdinand-stohr-NFs6dRTBgaM-unsplash-bcdff4ad859eb5ec0d2706b312fd360d.jpg) no-repeat 50% fixed;background-size:cover;text-align:center;position:relative;font-size:1.1rem}.home-intro-subtext{font-size:1.4rem}.header-name{color:#97ddff}.portrait{margin:2rem auto .2rem;border-radius:50%;max-width:200px}video{min-height:100%;min-width:100%;background:rgba(0,0,0,.5);position:absolute;top:0;left:0;bottom:0;opacity:.3}.video-background{position:relative;overflow:hidden}.home-content{position:relative;z-index:1}.portfolio-grid{display:grid;justify-content:space-between;grid-gap:30px;grid-template-columns:1fr 1fr 1fr;color:#dfddd8}@media screen and (max-width:980px){.portfolio-grid{grid-template-columns:1fr 1fr}}@media screen and (max-width:640px){.portfolio-grid{display:block}.portfolio-project{display:block;margin-bottom:1.5rem}}.portfolio-project h2,section{color:#dfddd8}.portfolio-project footer{color:#bdb8ae}.portfolio-project .project-pic{background:#1c1c1c;background-size:cover;background-position:50%;height:200px}.portfolio-heading{text-transform:uppercase;font-size:1.2rem}.col-1{grid-template-columns:1fr}.project-pic{margin-bottom:.4rem}.view-more-blog-text{margin-top:1rem;display:block;text-align:center}</style><meta name="generator" content="Gatsby 2.13.59"/><title data-react-helmet="true">Blog Post | Jeremy Bernier</title><meta data-react-helmet="true" name="description" content="This is Jeremy Bernier&#x27;s home in the internet. He is a software engineer, among other things."/><meta data-react-helmet="true" property="og:title" content="Blog Post"/><meta data-react-helmet="true" property="og:description" content="This is Jeremy Bernier&#x27;s home in the internet. He is a software engineer, among other things."/><meta data-react-helmet="true" property="og:type" content="website"/><meta data-react-helmet="true" name="twitter:card" content="summary"/><meta data-react-helmet="true" name="twitter:creator" content="@gatsbyjs"/><meta data-react-helmet="true" name="twitter:title" content="Blog Post"/><meta data-react-helmet="true" name="twitter:description" content="This is Jeremy Bernier&#x27;s home in the internet. He is a software engineer, among other things."/><style type="text/css">.gatsby-resp-image-image{width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;color:transparent;}</style><link rel="shortcut icon" href="/icons/icon-48x48.png?v=008654519ce705ac7bc44303a9014606"/><link rel="manifest" href="/manifest.webmanifest"/><meta name="theme-color" content="#663399"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=008654519ce705ac7bc44303a9014606"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=008654519ce705ac7bc44303a9014606"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=008654519ce705ac7bc44303a9014606"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=008654519ce705ac7bc44303a9014606"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=008654519ce705ac7bc44303a9014606"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=008654519ce705ac7bc44303a9014606"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=008654519ce705ac7bc44303a9014606"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=008654519ce705ac7bc44303a9014606"/><link as="script" rel="preload" href="/component---src-templates-blog-post-js-f3e6cbf884670981245d.js"/><link as="script" rel="preload" href="/1-7ced95fdc5a60487a55b.js"/><link as="script" rel="preload" href="/app-bdc66194670761d93422.js"/><link as="script" rel="preload" href="/styles-88457c9901b570c54b39.js"/><link as="script" rel="preload" href="/webpack-runtime-f7bd991ba76fa1edbc11.js"/><link as="fetch" rel="preload" href="/page-data/universal-javascript-app/page-data.json" crossorigin="use-credentials"/></head><body><noscript id="gatsby-noscript">This app works best with JavaScript enabled.</noscript><div id="___gatsby"><div style="outline:none" tabindex="-1" role="group" id="gatsby-focus-wrapper"><header style="background:black"><div class="header-inner" style="margin:0 auto;max-width:960px;padding:.3rem 1.0875rem"><nav class="header-links"><a href="/">Home</a><a href="/about">About</a><a href="/projects">Projects</a><a href="/blog">Blog</a><a href="/contact">Contact</a></nav><nav class="social-media-icons"><a href="https://www.facebook.com/jeremy.bernier" class="icon-10 facebook" title="Facebook"><svg class="icon" viewBox="0 0 512 512"><path d="M211.9 197.4h-36.7v59.9h36.7V433.1h70.5V256.5h49.2l5.2-59.1h-54.4c0 0 0-22.1 0-33.7 0-13.9 2.8-19.5 16.3-19.5 10.9 0 38.2 0 38.2 0V82.9c0 0-40.2 0-48.8 0 -52.5 0-76.1 23.1-76.1 67.3C211.9 188.8 211.9 197.4 211.9 197.4z"></path></svg></a><a href="https://twitter.com/jeremybernier" class="icon-link twitter" title="Twitter"><svg class="icon twitter" viewBox="0 0 512 512"><path d="M419.6 168.6c-11.7 5.2-24.2 8.7-37.4 10.2 13.4-8.1 23.8-20.8 28.6-36 -12.6 7.5-26.5 12.9-41.3 15.8 -11.9-12.6-28.8-20.6-47.5-20.6 -42 0-72.9 39.2-63.4 79.9 -54.1-2.7-102.1-28.6-134.2-68 -17 29.2-8.8 67.5 20.1 86.9 -10.7-0.3-20.7-3.3-29.5-8.1 -0.7 30.2 20.9 58.4 52.2 64.6 -9.2 2.5-19.2 3.1-29.4 1.1 8.3 25.9 32.3 44.7 60.8 45.2 -27.4 21.4-61.8 31-96.4 27 28.8 18.5 63 29.2 99.8 29.2 120.8 0 189.1-102.1 185-193.6C399.9 193.1 410.9 181.7 419.6 168.6z"></path></svg></a><a href="https://www.linkedin.com/in/jeremysbernier" class="icon-17 linkedin" title="LinkedIn"><svg class="icon" viewBox="0 0 512 512"><path d="M186.4 142.4c0 19-15.3 34.5-34.2 34.5 -18.9 0-34.2-15.4-34.2-34.5 0-19 15.3-34.5 34.2-34.5C171.1 107.9 186.4 123.4 186.4 142.4zM181.4 201.3h-57.8V388.1h57.8V201.3zM273.8 201.3h-55.4V388.1h55.4c0 0 0-69.3 0-98 0-26.3 12.1-41.9 35.2-41.9 21.3 0 31.5 15 31.5 41.9 0 26.9 0 98 0 98h57.5c0 0 0-68.2 0-118.3 0-50-28.3-74.2-68-74.2 -39.6 0-56.3 30.9-56.3 30.9v-25.2H273.8z"></path></svg></a><a href="https://github.com/JeremyBernier" class="icon-13 github" title="GitHub"><svg class="icon" viewBox="0 0 512 512"><path d="M256 70.7c-102.6 0-185.9 83.2-185.9 185.9 0 82.1 53.3 151.8 127.1 176.4 9.3 1.7 12.3-4 12.3-8.9V389.4c-51.7 11.3-62.5-21.9-62.5-21.9 -8.4-21.5-20.6-27.2-20.6-27.2 -16.9-11.5 1.3-11.3 1.3-11.3 18.7 1.3 28.5 19.2 28.5 19.2 16.6 28.4 43.5 20.2 54.1 15.4 1.7-12 6.5-20.2 11.8-24.9 -41.3-4.7-84.7-20.6-84.7-91.9 0-20.3 7.3-36.9 19.2-49.9 -1.9-4.7-8.3-23.6 1.8-49.2 0 0 15.6-5 51.1 19.1 14.8-4.1 30.7-6.2 46.5-6.3 15.8 0.1 31.7 2.1 46.6 6.3 35.5-24 51.1-19.1 51.1-19.1 10.1 25.6 3.8 44.5 1.8 49.2 11.9 13 19.1 29.6 19.1 49.9 0 71.4-43.5 87.1-84.9 91.7 6.7 5.8 12.8 17.1 12.8 34.4 0 24.9 0 44.9 0 51 0 4.9 3 10.7 12.4 8.9 73.8-24.6 127-94.3 127-176.4C441.9 153.9 358.6 70.7 256 70.7z"></path></svg></a><a href="https://www.instagram.com/cityofjeremy" class="icon-link instagram" title="Instagram"><svg class="icon" viewBox="0 0 512 512"><g><path d="M256 109.3c47.8 0 53.4 0.2 72.3 1 17.4 0.8 26.9 3.7 33.2 6.2 8.4 3.2 14.3 7.1 20.6 13.4 6.3 6.3 10.1 12.2 13.4 20.6 2.5 6.3 5.4 15.8 6.2 33.2 0.9 18.9 1 24.5 1 72.3s-0.2 53.4-1 72.3c-0.8 17.4-3.7 26.9-6.2 33.2 -3.2 8.4-7.1 14.3-13.4 20.6 -6.3 6.3-12.2 10.1-20.6 13.4 -6.3 2.5-15.8 5.4-33.2 6.2 -18.9 0.9-24.5 1-72.3 1s-53.4-0.2-72.3-1c-17.4-0.8-26.9-3.7-33.2-6.2 -8.4-3.2-14.3-7.1-20.6-13.4 -6.3-6.3-10.1-12.2-13.4-20.6 -2.5-6.3-5.4-15.8-6.2-33.2 -0.9-18.9-1-24.5-1-72.3s0.2-53.4 1-72.3c0.8-17.4 3.7-26.9 6.2-33.2 3.2-8.4 7.1-14.3 13.4-20.6 6.3-6.3 12.2-10.1 20.6-13.4 6.3-2.5 15.8-5.4 33.2-6.2C202.6 109.5 208.2 109.3 256 109.3M256 77.1c-48.6 0-54.7 0.2-73.8 1.1 -19 0.9-32.1 3.9-43.4 8.3 -11.8 4.6-21.7 10.7-31.7 20.6 -9.9 9.9-16.1 19.9-20.6 31.7 -4.4 11.4-7.4 24.4-8.3 43.4 -0.9 19.1-1.1 25.2-1.1 73.8 0 48.6 0.2 54.7 1.1 73.8 0.9 19 3.9 32.1 8.3 43.4 4.6 11.8 10.7 21.7 20.6 31.7 9.9 9.9 19.9 16.1 31.7 20.6 11.4 4.4 24.4 7.4 43.4 8.3 19.1 0.9 25.2 1.1 73.8 1.1s54.7-0.2 73.8-1.1c19-0.9 32.1-3.9 43.4-8.3 11.8-4.6 21.7-10.7 31.7-20.6 9.9-9.9 16.1-19.9 20.6-31.7 4.4-11.4 7.4-24.4 8.3-43.4 0.9-19.1 1.1-25.2 1.1-73.8s-0.2-54.7-1.1-73.8c-0.9-19-3.9-32.1-8.3-43.4 -4.6-11.8-10.7-21.7-20.6-31.7 -9.9-9.9-19.9-16.1-31.7-20.6 -11.4-4.4-24.4-7.4-43.4-8.3C310.7 77.3 304.6 77.1 256 77.1L256 77.1z"></path><path d="M256 164.1c-50.7 0-91.9 41.1-91.9 91.9s41.1 91.9 91.9 91.9 91.9-41.1 91.9-91.9S306.7 164.1 256 164.1zM256 315.6c-32.9 0-59.6-26.7-59.6-59.6s26.7-59.6 59.6-59.6 59.6 26.7 59.6 59.6S288.9 315.6 256 315.6z"></path><circle cx="351.5" cy="160.5" r="21.5"></circle></g></svg></a><a href="mailto:
jeremy.s.bernier@gmail.com" class="icon-link mail" title="Email"><svg class="icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M0 3v18h24v-18h-24zm21.518 2l-9.518 7.713-9.518-7.713h19.036zm-19.518 14v-11.817l10 8.104 10-8.104v11.817h-20z"></path></svg></a></nav></div></header><main><article><div style="max-height:400px;overflow:hidden;margin:0 auto"></div><div style="margin:0 auto;max-width:960px;padding:0px 1.0875rem 1.45rem;padding-top:1rem"><h1>How to make a Universal Javascript Single-Page App with Server-Side Rendering</h1><p><time>August 20, 2019</time></p><div><p>In this post I will explain what this is, and the basic idea of how to make one. Feel free to check out <a href="/react-redux-node-boilerplate">my React Redux boilerplate</a> to see a working implementation of what I’m about to explain.</p>
<p>First, let’s define what a universal Javascript Single-Page app with server-side rendering is.</p>
<h3>Single-Page App</h3>
<p>A single-page app (SPA) is basically a website without page refreshes.</p>
<p>The main advantage is speed, but you can also do a hell of a lot more without page refreshes. For example, you can</p>
<ul>
<li>Have media playing across pages, such as music or video. Music players have to be SPAs because otherwise the music would stop every time you navigated to a new page (my first professional job working on an SPA was on a <a href="/iheart">music player website</a>).</li>
<li>Share state in memory across pages. I did this on <a href="/vroom">an ecommerce site I built</a> to cache product data and avoid having to refetch data that’s already been obtained, saving bandwidth as well.</li>
<li>Page animations</li>
</ul>
<p>Ultimately, SPAs are way faster and more powerful than normal websites. So why aren’t they the norm? Because they’ve historically been very complex to build. But now with libraries like React and React-Router, that is no longer the case.</p>
<p>Now a really simplistic way to build a SPA is to just bundle all your Javascript code on the client, send an incomplete HTML file and offload all the rendering work to the client. In fact, the first front-end frameworks like Angular 1 did this. The problem is that 1. the website loads jankier and slower with a lot of shifting elements, meaning an inferior user experience 2. terrible for SEO because search engines can’t crawl your site.</p>
<p>A better way is to initially render the site on the server (<strong>server-side rendering</strong>), and then for subsequent page navigations, you render on the client.</p>
<p>Ok, so we know that to render our views on the client, we need to use Javascript because it’s the only language web browsers accept for client-side scripting (though with Web Assembly, maybe that’ll change in the future). So how do we render our views on the server?</p>
<p>Before Node.js, you would’ve had to rewrite your client-side rendering logic in whatever language you were using on the backend (eg. Python). But thankfully with Node.js, you can reuse the same client-side Javascript code on the server.</p>
<h3>Universal Javascript (a.k.a isomorphic Javascript)</h3>
<p>This just means that your Javascript runs on both the client and the server (via Node.js). If your rendering logic is on both the client and server, then you can reuse the same code. This reduces the amount of code and leaves one source of truth, saving the developer the time and hassle of dealing with multiple codebases.</p>
<h3>Building a SPA</h3>
<p>Great, so now we know that we can use Node.js to build a blazing fast SPA with server-side rendering. How do we actually build one?</p>
<p>First of all, there are frameworks like <a href="https://nextjs.org/">Next.js</a> which do a lot of the work for you (and for static websites, <a href="https://www.gatsbyjs.org">Gatsby</a>). But let’s say you want to build one yourself without being tied down to a framework.</p>
<p><strong>1. Transferring state from server to client</strong></p>
<p>It’s important that on the initial page load, the client receives not only the fully rendered HTML, but also the application state. You can send the state from server to client by simply defining it as a global variable on the <code class="language-text">window</code> object in your server-side HTML template, and then reading this on the client (note: you should generally never use global variables on the <code class="language-text">window</code> object, but this is one of those cases where it’s unavoidable).</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">// ServerHtmlTemplate.js

&lt;body&gt;
  ...
  &lt;script&gt;
    window.__INITIAL_STATE__= ${JSON.stringify(initialState)}
  &lt;/script&gt;
&lt;/body&gt;</code></pre></div>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">// client.js

const initialState = window.__INITIAL_STATE__
const store = configureStore(initialState) // Create Redux store using this state</code></pre></div>
<p>In this case, <code class="language-text">window.__INITIAL_STATE__</code> is the global variable that stores all of your initial state data. If you’re using Redux (a popular React state management library), then you can then set your store to this initial state.</p>
<p><strong>2. Asynchronous calls</strong></p>
<p>Naturally you’re going to have pages where you make an API call to fetch all of the data necessary for the page. For example, a blog will have a page with a list of all of the blog posts. How do you cleanly do this in a SPA?</p>
<p>The way I implemented this in my boilerplate was to have an optional static <code class="language-text">fetchData()</code> function that can be specified on any React page component and returns a <code class="language-text">Promise</code>. Within this function, any asynchronous API calls can be specified. Then in your server and client-side rendering logic, you can first check for the existence of this fetchData() function, and if it exists, you can call it first and defer rendering until it’s complete.</p>
<p>However, if you are doing this, <code class="language-text">it is extremely important to set a timeout</code> in case the API call takes forever or hangs indefinitely. Otherwise your user will be forced to sit their with a blank page until the call is finished or the connection times out. I handled this by setting a 1 second timeout (check the <code class="language-text">serverRender.js</code> file of my boilerplate to see this implementation).</p>
<p><strong>3. Code Splitting</strong></p>
<p>Without code splitting, a large SPA would contain all of the code of the entire website, which could potentially be a very massive Javascript file. Thankfully with code splitting, we can avoid this and only send the code required for the current page. With webpack, this is pretty simple to implement. Bundles can be separated as follows:</p>
<ul>
<li><em>vendor.js</em> - This bundle will contain all of your NPM module dependencies. The idea is that it won’t change as frequently</li>
<li><em>main.js</em> - This will contain all of your main application logic</li>
<li><em>[specific-page].js</em> - This will contain the code for the specific page that the user is accessing.</li>
</ul>
<p>By splitting up your code, you can increase performance and save bandwidth by only loading the code that’s necessary, while caching the code that changes infrequently.</p>
<p><strong>4. The URL should be the single source of truth</strong></p>
<p>One of the lessons I learned working on SPAs was that the URL should be the single source of truth. By that, I mean that any API calls or actions you take should assume that the user has come directly from the URL (excluding caching).</p>
<p>For example, if you have an ecommerce website with a catalog page containing a list of products and a bunch of filters, each filter should contain a valid URL, and from that URL alone you should be able to generate the page. Do not add any fancer reducer logic (Redux terminology) to make specific state changes on the PAGE_CHANGE. Just assume the user is navigating directly to the URL. Then it will always work, and as a developer the code is easier to understand and maintain anyways.</p>
<h3>Conclusion</h3>
<p>This is a high-level overview of Universal Javascript SPAs. Check out <a href="/universal-javascript-app">my React/Redux SPA boilerplate</a> to see a working example that I created and <a href="/vroom">used in production at my last job</a>.</p>
<p>As it gets easier and easier to make SPAs, they will become the norm because they offer a superior user experience. Props to all the open source developers who’ve made it fairly reasonable to set up. It’ll be exciting to see where things go in the future.</p></div></div></article></main><footer class="page-footer"><div style="margin:0 auto;max-width:960px;padding:0px 1.0875rem 1.45rem;padding-top:0"><div class="page-footer-grid"><div>© <!-- -->2019<!-- -->, Built by Jeremy<!-- --> <a href="/building-gatsby-site">(see how)</a></div><nav class="footer-social-icons"><a href="https://www.facebook.com/jeremy.bernier" class="icon-10 facebook" title="Facebook"><svg class="icon" viewBox="0 0 512 512"><path d="M211.9 197.4h-36.7v59.9h36.7V433.1h70.5V256.5h49.2l5.2-59.1h-54.4c0 0 0-22.1 0-33.7 0-13.9 2.8-19.5 16.3-19.5 10.9 0 38.2 0 38.2 0V82.9c0 0-40.2 0-48.8 0 -52.5 0-76.1 23.1-76.1 67.3C211.9 188.8 211.9 197.4 211.9 197.4z"></path></svg></a><a href="https://twitter.com/jeremybernier" class="icon-link twitter" title="Twitter"><svg class="icon twitter" viewBox="0 0 512 512"><path d="M419.6 168.6c-11.7 5.2-24.2 8.7-37.4 10.2 13.4-8.1 23.8-20.8 28.6-36 -12.6 7.5-26.5 12.9-41.3 15.8 -11.9-12.6-28.8-20.6-47.5-20.6 -42 0-72.9 39.2-63.4 79.9 -54.1-2.7-102.1-28.6-134.2-68 -17 29.2-8.8 67.5 20.1 86.9 -10.7-0.3-20.7-3.3-29.5-8.1 -0.7 30.2 20.9 58.4 52.2 64.6 -9.2 2.5-19.2 3.1-29.4 1.1 8.3 25.9 32.3 44.7 60.8 45.2 -27.4 21.4-61.8 31-96.4 27 28.8 18.5 63 29.2 99.8 29.2 120.8 0 189.1-102.1 185-193.6C399.9 193.1 410.9 181.7 419.6 168.6z"></path></svg></a><a href="https://www.linkedin.com/in/jeremysbernier" class="icon-17 linkedin" title="LinkedIn"><svg class="icon" viewBox="0 0 512 512"><path d="M186.4 142.4c0 19-15.3 34.5-34.2 34.5 -18.9 0-34.2-15.4-34.2-34.5 0-19 15.3-34.5 34.2-34.5C171.1 107.9 186.4 123.4 186.4 142.4zM181.4 201.3h-57.8V388.1h57.8V201.3zM273.8 201.3h-55.4V388.1h55.4c0 0 0-69.3 0-98 0-26.3 12.1-41.9 35.2-41.9 21.3 0 31.5 15 31.5 41.9 0 26.9 0 98 0 98h57.5c0 0 0-68.2 0-118.3 0-50-28.3-74.2-68-74.2 -39.6 0-56.3 30.9-56.3 30.9v-25.2H273.8z"></path></svg></a><a href="https://github.com/JeremyBernier" class="icon-13 github" title="GitHub"><svg class="icon" viewBox="0 0 512 512"><path d="M256 70.7c-102.6 0-185.9 83.2-185.9 185.9 0 82.1 53.3 151.8 127.1 176.4 9.3 1.7 12.3-4 12.3-8.9V389.4c-51.7 11.3-62.5-21.9-62.5-21.9 -8.4-21.5-20.6-27.2-20.6-27.2 -16.9-11.5 1.3-11.3 1.3-11.3 18.7 1.3 28.5 19.2 28.5 19.2 16.6 28.4 43.5 20.2 54.1 15.4 1.7-12 6.5-20.2 11.8-24.9 -41.3-4.7-84.7-20.6-84.7-91.9 0-20.3 7.3-36.9 19.2-49.9 -1.9-4.7-8.3-23.6 1.8-49.2 0 0 15.6-5 51.1 19.1 14.8-4.1 30.7-6.2 46.5-6.3 15.8 0.1 31.7 2.1 46.6 6.3 35.5-24 51.1-19.1 51.1-19.1 10.1 25.6 3.8 44.5 1.8 49.2 11.9 13 19.1 29.6 19.1 49.9 0 71.4-43.5 87.1-84.9 91.7 6.7 5.8 12.8 17.1 12.8 34.4 0 24.9 0 44.9 0 51 0 4.9 3 10.7 12.4 8.9 73.8-24.6 127-94.3 127-176.4C441.9 153.9 358.6 70.7 256 70.7z"></path></svg></a><a href="https://www.instagram.com/cityofjeremy" class="icon-link instagram" title="Instagram"><svg class="icon" viewBox="0 0 512 512"><g><path d="M256 109.3c47.8 0 53.4 0.2 72.3 1 17.4 0.8 26.9 3.7 33.2 6.2 8.4 3.2 14.3 7.1 20.6 13.4 6.3 6.3 10.1 12.2 13.4 20.6 2.5 6.3 5.4 15.8 6.2 33.2 0.9 18.9 1 24.5 1 72.3s-0.2 53.4-1 72.3c-0.8 17.4-3.7 26.9-6.2 33.2 -3.2 8.4-7.1 14.3-13.4 20.6 -6.3 6.3-12.2 10.1-20.6 13.4 -6.3 2.5-15.8 5.4-33.2 6.2 -18.9 0.9-24.5 1-72.3 1s-53.4-0.2-72.3-1c-17.4-0.8-26.9-3.7-33.2-6.2 -8.4-3.2-14.3-7.1-20.6-13.4 -6.3-6.3-10.1-12.2-13.4-20.6 -2.5-6.3-5.4-15.8-6.2-33.2 -0.9-18.9-1-24.5-1-72.3s0.2-53.4 1-72.3c0.8-17.4 3.7-26.9 6.2-33.2 3.2-8.4 7.1-14.3 13.4-20.6 6.3-6.3 12.2-10.1 20.6-13.4 6.3-2.5 15.8-5.4 33.2-6.2C202.6 109.5 208.2 109.3 256 109.3M256 77.1c-48.6 0-54.7 0.2-73.8 1.1 -19 0.9-32.1 3.9-43.4 8.3 -11.8 4.6-21.7 10.7-31.7 20.6 -9.9 9.9-16.1 19.9-20.6 31.7 -4.4 11.4-7.4 24.4-8.3 43.4 -0.9 19.1-1.1 25.2-1.1 73.8 0 48.6 0.2 54.7 1.1 73.8 0.9 19 3.9 32.1 8.3 43.4 4.6 11.8 10.7 21.7 20.6 31.7 9.9 9.9 19.9 16.1 31.7 20.6 11.4 4.4 24.4 7.4 43.4 8.3 19.1 0.9 25.2 1.1 73.8 1.1s54.7-0.2 73.8-1.1c19-0.9 32.1-3.9 43.4-8.3 11.8-4.6 21.7-10.7 31.7-20.6 9.9-9.9 16.1-19.9 20.6-31.7 4.4-11.4 7.4-24.4 8.3-43.4 0.9-19.1 1.1-25.2 1.1-73.8s-0.2-54.7-1.1-73.8c-0.9-19-3.9-32.1-8.3-43.4 -4.6-11.8-10.7-21.7-20.6-31.7 -9.9-9.9-19.9-16.1-31.7-20.6 -11.4-4.4-24.4-7.4-43.4-8.3C310.7 77.3 304.6 77.1 256 77.1L256 77.1z"></path><path d="M256 164.1c-50.7 0-91.9 41.1-91.9 91.9s41.1 91.9 91.9 91.9 91.9-41.1 91.9-91.9S306.7 164.1 256 164.1zM256 315.6c-32.9 0-59.6-26.7-59.6-59.6s26.7-59.6 59.6-59.6 59.6 26.7 59.6 59.6S288.9 315.6 256 315.6z"></path><circle cx="351.5" cy="160.5" r="21.5"></circle></g></svg></a><a href="mailto:
jeremy.s.bernier@gmail.com" class="icon-link mail" title="Email"><svg class="icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M0 3v18h24v-18h-24zm21.518 2l-9.518 7.713-9.518-7.713h19.036zm-19.518 14v-11.817l10 8.104 10-8.104v11.817h-20z"></path></svg></a></nav></div></div></footer></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/universal-javascript-app/";window.webpackCompilationHash="9113aca8fbd6afb66351";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"app":["/app-bdc66194670761d93422.js"],"component---src-templates-blog-post-js":["/component---src-templates-blog-post-js-f3e6cbf884670981245d.js"],"component---src-pages-404-js":["/component---src-pages-404-js-fbadd7a757166186eac6.js"],"component---src-pages-about-js":["/component---src-pages-about-js-e83f99c39f61754ca6e9.js"],"component---src-pages-blog-js":["/component---src-pages-blog-js-60fe75df30b015e7bd73.js"],"component---src-pages-contact-js":["/component---src-pages-contact-js-4827f3961bd7603a83fc.js"],"component---src-pages-index-js":["/component---src-pages-index-js-836db0baca9158f8ce88.js"],"component---src-pages-projects-js":["/component---src-pages-projects-js-51549f970cd170c41b3a.js"],"component---src-pages-subscribe-js":["/component---src-pages-subscribe-js-623d3b312976da0c159a.js"],"component---src-pages-tutorials-js":["/component---src-pages-tutorials-js-a9ed998058d965becce3.js"]};/*]]>*/</script><script src="/webpack-runtime-f7bd991ba76fa1edbc11.js" async=""></script><script src="/styles-88457c9901b570c54b39.js" async=""></script><script src="/app-bdc66194670761d93422.js" async=""></script><script src="/1-7ced95fdc5a60487a55b.js" async=""></script><script src="/component---src-templates-blog-post-js-f3e6cbf884670981245d.js" async=""></script></body></html>